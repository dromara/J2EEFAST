<#include "/common/defaultEngine.html"/>
<@pageTheme mark="${config.optimize()?string('true', 'false')}">
<@header title="修改生成信息" bodyClass="gray-bg animated fadeInRight" isAnimation="false" libs=["table","zTree","tableReorder"]>
<style type="text/css">
	.select-table table{table-layout:fixed;}.table>thead>tr>th{text-align:center;}
	.select-table .table td{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}
	.icheckbox-blue{top:0px !important;}
	.form-control.select2-hidden-accessible{position:static!important;}
	.select-table table label.error{position: inherit;}select + label.error{z-index:1;right:40px;}
	.table{
		table-layout: fixed;
	}
	th {
		font-weight:normal;
	}
	.table-striped .table>thead>tr>th, .table-striped .table>tbody>tr>th {
		border-bottom: 1px solid #ccc!important;
		border-right: 1px solid #ccc!important;
		border-top: 1px!important;
	}
	.fixed-table-container {
		border: 1px solid #ddd;
	}
	.table-striped .table, .table-striped .table, .table>thead>tr>th, .table>tbody>tr>th, .table>tfoot>tr>th, .table>thead>tr>td, .table>tbody>tr>td, .table>tfoot>tr>td {
		border-bottom: 1px solid #e7eaec!important;
		background-color: transparent;
		border-right: 1px solid #e7eaec!important;
	}
	.fixed-table-container thead th .th-inner {
		padding: 7px 0 5px 2px;
	}
	.bootstrap-table .table:not(.table-condensed)>tbody>tr>td{
		padding: 3px 6px;
	}
	.select2-container--bootstrap .select2-selection--single {
		height: 30px;
	}
	.check-box{
		margin: 0px;
		padding: 0!important;
		width: 18px;
		height: 18px;
		border: 0;
	}
</style>
</@header>
    <section class="section-content">
    <div class="row">
        <div class="col-xs-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content" style="border-style:none;">
                    <div class="nav-tabs-custom">
                        <ul class="nav nav-tabs">
                            <li class="active"><a href="#tab-basic" data-toggle="tab" aria-expanded="false">基本信息</a></li>
                            <li><a href="#tab-field" data-toggle="tab" aria-expanded="true">字段信息</a></li>
                            <li><a href="#tab-gen" data-toggle="tab" aria-expanded="false">生成信息</a></li>
                            <li class="pull-right header">
								<i class="fa fa-code"></i> 生成配置
							</li>
                        </ul>
                        <form id="form-gen-edit" class="form-horizontal">
                        <input name="id" type="hidden" value="${gen_table.id?default("")}" />
						<input name="parentId" type="hidden" value="${gen_table.parentId?default("")}" />
						<input name="parentName" type="hidden" value="${gen_table.parentName?default("")}" />
						<input name="menuOrder" type="hidden" value="${gen_table.menuOrder?default("")}" />
						<input name="moduleCodes" type="hidden" value="${gen_table.moduleCodes?default("")}" />
						<input name="menuIcon" type="hidden" value="${gen_table.menuIcon?default("")}" />
						<input name="menuTarget" type="hidden" value="${gen_table.menuTarget?default("")}" />

                        <div class="tab-content" style="padding-top: 10px;">
                            <!-- 基本信息 -->
                            <div class="tab-pane animated fadeInUp active" id="tab-basic">
				            <div class="row mt20">
				            	<div class="col-sm-6">
				                    <div class="form-group">
				                        <label class="col-sm-4 control-label"><span style="color: red; ">*</span>表名称：</label>
				                        <div class="col-sm-8">
				                            <input name="tableName" class="form-control" type="text" placeholder="请输入表名称" maxlength="200" value="${gen_table.tableName}" required>
				                        </div>
				                    </div>
				                </div>
				                <div class="col-sm-6">
				                    <div class="form-group">
				                        <label class="col-sm-4 control-label"><span style="color: red; ">*</span>表描述：</label>
				                        <div class="col-sm-8">
				                            <input name="tableComment" class="form-control" type="text" placeholder="请输入表描述" maxlength="500" value="${gen_table.tableComment}" required>
				                        </div>
				                    </div>
				                </div>
				            </div>
				            <div class="row">
				                <div class="col-sm-6">
				                    <div class="form-group">
				                        <label class="col-sm-4 control-label"><span style="color: red; ">*</span>实体类名称：</label>
				                        <div class="col-sm-8">
				                            <input name="className" class="form-control" type="text" placeholder="请输入实体类名称" maxlength="100" value="${gen_table.className}" required>
				                        </div>
				                    </div>
				                </div>
				                <div class="col-sm-6">
				                    <div class="form-group">
				                        <label class="col-sm-4 control-label"><span style="color: red; ">*</span>作者：</label>
				                        <div class="col-sm-8">
				                            <input name="functionAuthor" class="form-control" type="text" placeholder="请输入作者" maxlength="50" value="${gen_table.functionAuthor}" required>
				                        </div>
				                    </div>
				                </div>
				            </div>
				            <div class="row">
				                <div class="col-sm-12">
				                    <div class="form-group">
				                        <label class="col-xs-2 control-label">备注：</label>
				                        <div class="col-xs-10">
				                            <textarea name="remark" maxlength="500" class="form-control" rows="3"></textarea>
				                        </div>
				                    </div>
				                </div>
				            </div>
                            </div>
                            
                            
                            
                            <!-- 字段信息 -->
                            <div class="tab-pane animated fadeInUp" id="tab-field">
                                  <button type="button" class="btn btn-sm btn-primary" onclick="refreshTableColumn()"><i class="fa fa-refresh"></i>从库中更新表栏位</button>
                                <div class="select-table table-striped" style="margin-top: 0px;padding-top: 0px;padding-bottom: 0px;">
								    <table id="bootstrap-table" data-use-row-attr-func="true" data-reorderable-rows="true"></table>
								</div>
                            </div>
                            
                            <!-- 生成信息 -->
                            <div class="tab-pane animated fadeInUp" id="tab-gen">
					            <div class="row mt20">
					            	<div class="col-sm-6">
					                    <div class="form-group">
					                        <label class="col-sm-4 control-label"><span style="color: red; ">*</span>生成模板：</label>
					                        <div class="col-sm-8">
<#--												<select id="tplCategory" class="selectpicker" data-none-selected-text="请选择" multiple>-->
<#--													<option value="crud" <#if gen_table.tplCategory == 'crud' >selected = "selected"</#if>>单表（增删改查）</option>-->
<#--													<option value="tree" <#if gen_table.tplCategory == 'tree' >selected = "selected"</#if>>树表（增删改查）</option>-->
<#--												</select>-->

					                            <select class='form-control' id="tplCategory" name='tplCategory' style="width: 100%">
												    <option value="crud" <#if gen_table.tplCategory == 'crud' >selected = "selected"</#if>>单表（增删改查）</option>
													<option value="r" <#if gen_table.tplCategory == 'r' >selected = "selected"</#if>>单表（查）</option>
													<option value="service" <#if gen_table.tplCategory == 'service' >selected = "selected"</#if>>业务层和持久层（不含控制器和视图）</option>
													<option value="entity" <#if gen_table.tplCategory == 'entity' >selected = "selected"</#if>>只有实体类（entity) </option>
												    <option value="tree" <#if gen_table.tplCategory == 'tree' >selected = "selected"</#if>>树表（增删改查）</option>
												</select>
					                        </div>
					                    </div>
					                </div>
					                <div class="col-sm-6">
					                    <div class="form-group">
					                        <label class="col-sm-4 control-label" title="生成在哪个java包下，例如 com.j2eefast.framework.sys"><span style="color: red; ">*</span>生成包路径：<i class="fa fa-question-circle-o"></i></label>
					                        <div class="col-sm-8">
					                            <input name="packageName" class="form-control" type="text" placeholder="请输入生成包路径" maxlength="100" value="${gen_table.packageName}" required>
					                        </div>
					                    </div>
					                </div>
					            </div>
					            <div class="row">
					                <div class="col-sm-6">
					                    <div class="form-group">
					                        <label class="col-sm-4 control-label" title="可理解为子系统名，例如 sys, 公交项目bcs"><span style="color: red; ">*</span>生成模块名：<i class="fa fa-question-circle-o"></i></label>
					                        <div class="col-sm-8">
					                            <input name="moduleName" class="form-control" type="text" placeholder="请输入生成模块名" maxlength="30" value="${gen_table.moduleName?default("")}" required>
					                        </div>
					                    </div>
					                </div>
					                <div class="col-sm-6">
					                    <div class="form-group">
					                        <label class="col-sm-4 control-label" title="可理解为功能英文名需要小写，例如 user 用户管理,菜单功能 menu"><span style="color: red; ">*</span>生成业务名：<i class="fa fa-question-circle-o"></i></label>
					                        <div class="col-sm-8">
					                            <input name="businessName" class="form-control" type="text" placeholder="请输入生成业务名" maxlength="50" value="${gen_table.businessName}" required>
					                        </div>
					                    </div>
					                </div>
					            </div>
					            <div class="row">
					                <div class="col-sm-6">
					                    <div class="form-group">
					                        <label class="col-sm-4 control-label" title="用作类描述，例如 用户"><span style="color: red; ">*</span>生成功能名：<i class="fa fa-question-circle-o"></i></label>
					                        <div class="col-sm-8">

					                            <input name="functionName" class="form-control" type="text" placeholder="请输入生成功能名" maxlength="50" value="${gen_table.functionName}" required>
					                        </div>
					                    </div>
					                </div>
									<div class="col-sm-6">
										<div class="form-group">
											<label class="col-sm-4 control-label"><span style="color: red; ">*</span>数据库：</label>
											<div class="col-sm-8">
												<select id="dbName" name="dbName" class="form-control">
													<#list listDb>
														<#items as d>
															<#if d.status =='0' >
																<option  value="${d.dbName}" <#if gen_table.dbName == d.dbName>selected = "selected"</#if> >${d.dbName}</option>
															</#if>
														</#items>
													</#list>
												</select>
											</div>
										</div>
									</div>
					            </div>
								<div class="row">
									<div class="col-sm-6">
										<div class="form-group">
											<label class="col-sm-4 control-label" title="代码生成本地是否覆盖一样的文件"><span style="color: red; ">*</span>生成文件是否覆盖：<i class="fa fa-question-circle-o"></i></label>
											<div class="col-sm-8">
												<#list dict.getType('sys_yes_no')>
													<#items as d>
														<div class="radio-box">
															<input type="radio" name="isCover" value="${d.dictValue}"
																   <#if (d.isDefault =='Y' && gen_table.isCover == "") ||
																   (gen_table.isCover ==d.dictValue ) >checked</#if>>
															<label><@ctx.i18n text = "${d.dictLabel}"/></label>
														</div>
													</#items>
												</#list>
											</div>
										</div>
									</div>
									<div class="col-sm-6">
										<div class="form-group">
											<label class="col-sm-4 control-label"><span style="color: red; ">*</span>设置菜单：</label>
											<div class="col-sm-8">
												<div class="input-group">
													<input class="form-control" type="text" onclick="selectMenu()" id="menuName" name="menuName" readonly="true" value="${gen_table.menuName}">
													<span class="input-group-btn"><a  href="javascript:selectMenu();"><i id="menuIconIcon" class="fa fa-fw ${gen_table.menuIcon?default("")}"></i></a></span>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-xs-12">
										<div class="form-group">
											<label class="col-sm-2 control-label"><span style="color: red; ">*</span>生成基础路径：
												<a tabindex="0" role="button" data-toggle="popover" data-trigger="focus" data-placement="bottom"
												   data-content="代码生成项目基本路径,只需要填你项目路径例如:D:\LiXinOS\lixinos-bcs\src 生成到你电脑本地项目源码路径">
													<i class="fa fa-question-circle-o" style="color: orange"></i></a>
											</label>
											<div class="col-sm-10">
												<div class="input-group input-group-sm">
													<input id="runPath" name="runPath" class="form-control" type="text" placeholder="请输入项目路径" maxlength="2000" value="${gen_table.runPath}">
													<div class="input-group-addon">
														<a  class="dropdown-toggle" data-toggle="dropdown">
															最近路径快速选择 <span class="caret"></span>
														</a>
														<ul class="dropdown-menu dropdown-menu-right" role="menu" style="max-height:150px;max-width:700px;">
															<li><a href="javascript:selectDirTree();"><i class="fa fa-hdd-o"></i>选择本地路径</a></li>
															<li><a href="javascript:$('#runPath').val('/')"><i class="fa fa-refresh"></i>恢复默认的生成基础路径</a></li>
														</ul>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
								<div id="setTable">
									<h4 class="form-header h4">其他选项</h4>
									<div class="row" id="isTableFile">
										<div class="col-sm-6">
											<div class="form-group">
												<label class="col-sm-4 control-label" title="表单是否有上传图片"><span style="color: red; ">*</span>是否有上传图片：<i class="fa fa-question-circle-o"></i></label>
												<div class="col-sm-8">
													<@form.radio name="isImg" dictType="sys_yes_no" value="${gen_table.isImg}"/>
												</div>
											</div>
										</div>
										<div class="col-sm-6">
											<div class="form-group">
												<label class="col-sm-4 control-label" title="表单是否有上传文件"><span style="color: red; ">*</span>是否有上传文件：<i class="fa fa-question-circle-o"></i></label>
												<div class="col-sm-8">
													<@form.radio name="isFile" dictType="sys_yes_no" value="${gen_table.isFile}"/>
												</div>
											</div>
										</div>
									</div>
									<div class="row">
										<div class="col-sm-6" id="isTableBut">
											<div class="form-group">
												<label class="col-sm-4 control-label" title="展示页面表格操作按钮风格"><span style="color: red; ">*</span>表操作按钮风格：<i class="fa fa-question-circle-o"></i></label>
												<div class="col-sm-8">
													<select class='form-control' name="actionsType">
														<#list dict.getType('sys_table_actions_type')>
															<#items as d>
																<#if d.status =='0'>
																	<option  value="${d.dictValue}" <#if gen_table.actionsType == d.dictValue>selected = "selected"</#if> >${d.dictLabel}</option>
																</#if>
															</#items>
														</#list>
													</select>
												</div>
											</div>
										</div>
										<div id="isTabOpen" class="col-sm-6">
											<div class="form-group">
												<label class="col-sm-4 control-label" title="增改页面打开形式,可以TAB、弹出方式,如果表单数据不多建议弹出方式"><span style="color: red; ">*</span>增改页面打开形式：<i class="fa fa-question-circle-o"></i></label>
												<div class="col-sm-8">
													<select class='form-control' id="target" name='target' style="width: 100%">
														<option value="alert" <#if gen_table.target == 'alert' >selected = "selected"</#if>>弹出形式</option>
														<option value="tab" <#if gen_table.target == 'tab' >selected = "selected"</#if>>TAB形式</option>
													</select>
												</div>
											</div>
										</div>
									</div>
									<div class="row">
										<div id="isTableDel" class="col-sm-6 hide">
											<div class="form-group">
												<label class="col-sm-4 control-label" title="单查询页面是否需要删除按钮"><span style="color: red; ">*</span>是否有删除功能：<i class="fa fa-question-circle-o"></i></label>
												<div class="col-sm-8">
													<#list dict.getType('sys_yes_no')>
														<#items as d>
															<div class="radio-box">
																<input type="radio" name="isDel" value="${d.dictValue}"
																	   <#if (d.isDefault =='Y' && gen_table.isDel == "") ||
																	   (gen_table.isDel ==d.dictValue ) >checked</#if>>
																<label><@ctx.i18n text = "${d.dictLabel}"/></label>
															</div>
														</#items>
													</#list>
												</div>
											</div>
										</div>
									</div>
								</div>
					            <div class="hidden" id="otherInfo">
					            <h4 class="form-header h4">其他信息</h4>
					            <div class="row">
					                <div class="col-sm-6">
					                    <div class="form-group">
					                        <label class="col-sm-4 control-label" title="树显示的编码字段名， 如：dept_id"><span style="color: red; ">*</span>树编码字段：<i class="fa fa-question-circle-o"></i></label>
					                        <div class="col-sm-8">
					                            <select class='form-control' id="treeCode" name='option.treeCode' style="width: 100%">
					                                <option value="">---请选择---</option>
													<#list gen_table.columns>
														<#items as d>
															<option value="${d.columnName?default("")}"   <#if (gen_table.option.treeCode)?default("") == d.columnName?default("")>selected = "selected"</#if> >${d.columnName?default("")}->${d.columnComment?default("")}</option>
														</#items>
													</#list>
												</select>
					                        </div>
					                    </div>
					                </div>
					                <div class="col-sm-6">
					                    <div class="form-group">
					                        <label class="col-sm-4 control-label" title="树显示的父编码字段名， 如：parent_Id"><span style="color: red; ">*</span>树父编码字段：<i class="fa fa-question-circle-o"></i></label>
					                        <div class="col-sm-8">
					                            <select class='form-control' id="treeParentCode" name='option.treeParentCode' style="width: 100%">
												    <option value="">---请选择---</option>
													<#list gen_table.columns>
														<#items as d>
															<option value="${d.columnName?default("")}"   <#if (gen_table.option.treeParentCode)?default("") == d.columnName?default("")>selected = "selected"</#if>   >${d.columnName?default("")}-> ${d.columnComment?default("")}</option>
														</#items>
													</#list>
												</select>
					                        </div>
					                    </div>
					                </div>
					            </div>
					            <div class="row">
					                <div class="col-sm-6">
					                    <div class="form-group">
					                        <label class="col-sm-4 control-label" title="树节点的显示名称字段名， 如：dept_name"><span style="color: red; ">*</span>树名称字段：<i class="fa fa-question-circle-o"></i></label>
					                        <div class="col-sm-8">
					                            <select class='form-control' id="treeName" name='option.treeName' style="width: 100%">
												    <option value="">---请选择---</option>
													<#list gen_table.columns>
														<#items as d>
															<option value="${d.columnName?default("")}"    <#if (gen_table.option.treeName)?default("") == d.columnName?default("")>selected = "selected"</#if> >${d.columnName?default("")}->${d.columnComment?default("")}</option>
														</#items>
													</#list>
												</select>
					                        </div>
					                    </div>
					                </div>
					            </div>
					            </div>
                            </div>
                        </div>
                        </form>
                    </div>
                </div>
               <div class="box-footer">
			       <div class="col-sm-offset-5 col-sm-6 mb10">
			           <button type="button" class="btn btn-sm btn-primary" onclick="opt.form.submit()"><i class="fa fa-check"></i>保 存</button>&nbsp;
			           <button type="button" class="btn btn-sm btn-danger" onclick="opt.modal.closeTab()"><i class="fa fa-reply-all"></i>关 闭 </button>
			       </div>
           	   </div>
            </div>
        </div>
    </div>
	</section>
<@footer>
    <script type="text/javascript">
		var prefix = baseURL + "tool/gen";


	      /* 刷新数据库表*/
		function refreshTableColumn(){
           opt.modal.confirm("请确认更新?", function() {
        	   var  url = prefix + "/refreshTable/${gen_table.id}"; 
               opt.operate.get(url,"")
           });
		}
		
	    /*用户信息-修改*/
	    $("#form-table-edit").validate({
	    	rules: {
	    	    tableName: {
	    	        required: true,
	    	    },
	    	},
			focusCleanup: true
		}); 
	    
	    function submitHandler() {
	        if (opt.validate.form()) {
	        	opt.operate.saveTab(prefix + "/edit", $("#form-gen-edit").serializeArray());
	        }
	    }

	    function selectMenu() {
			opt.modal.open("<@ctx.i18n text = "设置菜单"/>",prefix + "/selectMenu/" +  $('input[name="id"]').val(),'','',doSubmitMenu,true)
        }

		function doSubmitMenu(index, layero,_layer){
			var body = opt.selfLayer.getChildFrame('body', index);
			var menuName = body.find('#name').val();
			var parentId = body.find('input[name="parentId"]').val();
			var parentName =body.find('#parentIdName').val();
			var moduleCodes = "";
			body.find('input[name="moduleCodes"]:checked').each(function () {
				moduleCodes += $(this).val() + ",";
			})
			moduleCodes = moduleCodes.substring(0,moduleCodes.length-1);
			var menuOrder = body.find('input[name="menuOrder"]').val();
			var menuIcon = body.find('input[name="icmenuIconon"]').val();
			var menuTarget = body.find('#menuTarget').val();

			$('input[name="parentId"]').val(parentId);
			$('input[name="menuName"]').val(menuName);
			$('input[name="moduleCodes"]').val(moduleCodes);
			$('input[name="menuOrder"]').val(menuOrder);
			$('input[name="menuIcon"]').val(menuIcon);
			$('input[name="parentName"]').val(parentName);
			$('input[name="menuTarget"]').val(menuTarget);
			$("#menuIconIcon").attr("class",'fa fa-fw '+menuIcon);
			_layer.close(index);
		}

		$(function() {
		    var options = {
		        url: prefix + "/column/list",
		        sortName: "sort",
		        sortOrder: "desc",
		        height: $(window).height() - 196,
		        pagination: false,
		        showSearch: false,
		        showRefresh: false,
		        showToggle: false,
		        showColumns: false,
		        //onLoadSuccess: onLoadSuccess,
		        onReorderRow: onReorderRow,
		        columns:
					// [
					// 	[
					// 		{
					// 			title: "字段",
					// 			align:"center",
					// 			colspan: 9,
					// 			width: "50%",
					// 		},
					// 		{
					// 			title: "列表",
					// 			align:"center",
					// 			colspan: 4,
					// 			width: "20%"
					// 		},
					// 		{
					// 			title: "表单",
					// 			align:"center",
					// 			colspan: 3,
					// 			width: "30%"
					// 		}
        			// ],
		        [{
                    title: $.i18n.prop("序号"),
                    width: "32",
					align: 'center',
                    formatter: function (value, row, index) {
                    	/*编号隐藏域*/
                    	var idHtml = opt.common.sprintf("<input type='hidden' name='columns[%s].id' value='%s'>", index, row.id);
                    	/*排序隐藏域*/
                    	var sortHtml = opt.common.sprintf("<input type='hidden' name='columns[%s].sort' value='%s' id='columns_sort_%s'>", index, row.sort, row.id);
                    	return idHtml + sortHtml +$.table.serialNumber(index);
                    }
                    // ,
                    // cellStyle: function(value, row, index) {
                    //     return { css: { "cursor": "move" } };
                    // }
                },
				{
					title: '<i class="fa fa-arrows" style="color:#aaa"></i>'
							+ "<a tabindex='0' role='button' data-toggle='popover' data-trigger='focus' " +
							"data-placement='top' data-html='true' data-content='<span style=\"color:red\">拖拽排序使生成展示页面表格显示顺序!<span>'><i class='fa fa-question-circle-o' style='color: orange'></i></a>",
					width: "32",
					align: 'center',
					class: "drag",
					formatter: function (value, row, index) {
						return '<i class="fa fa-arrows" style="color:#aaa"></i>';
					}
				},
		        {
		            field: 'columnName',
		            title: '字段列名',
		            width: "6%",
					formatter: function (value, row, index) {
						return $.table.tooltip(value,5);
					}
					// ,
		            // class: "nodrag"
					// ,
		            // cellStyle: function(value, row, index) {
                    //     return { css: { "cursor": "default" } };
                    // }
		        },
		        {
		            field: 'columnComment',
		            title: '字段描述',
		            width: "10%",
		            formatter: function (value, row, index) {
		            	var html = opt.common.sprintf("<input class='form-control' type='text' name='columns[%s].columnComment' value='%s'>", index, value);
		        		return html;
		        	}
		        },
		        {
		            field: 'columnType',
		            title: '物理类型',
		            width: "8%"
					// ,
		            // class: "nodrag"
					// ,
		            // cellStyle: function(value, row, index) {
                    //     return { css: { "cursor": "default" } };
                    // }
		        },
		        {
		            field: 'javaType',
		            title: 'Java类型',
		            width: "10%",
		            formatter: function (value, row, index) {
		        		var data = { "index": index, "javaType": value };
		                // return $("#javaTypeTpl").tmpl(data).html();
		                return opt.template('javaTypeTpl',data);
		        	}
		        },
		        {
		            field: 'javaField',
		            title: 'Java属性',
		            width: "10%",
		            formatter: function (value, row, index) {
		        		var html = opt.common.sprintf("<input class='form-control' type='text' name='columns[%s].javaField' value='%s' required>", index, value);
		        		return html;
		        	}
		        },
		         {
		            field: 'isPk',
		            title: "主键",
					titleTooltip:'请勿修改',
		            width: "32",
		            formatter: function (value, row, index) {
		            	var isCheck = value == 1 ? 'checked' : '';
		            	var html = opt.common.sprintf("<label class='check-box'><input type='checkbox' name='columns[%s].isPk' value='1' %s></label>", index, isCheck);
		        		return html;
		        	}
		        },
		        {
		            field: 'isInsert',
		            title: '插入',
					titleTooltip:'插入为新增页面需要客户录入的字段',
		            width: "32",
		            formatter: function (value, row, index) {
		            	var isCheck = value == 1 ? 'checked' : '';
		            	var html = opt.common.sprintf("<label class='check-box'><input type='checkbox' name='columns[%s].isInsert' value='1' %s></label>", index, isCheck);
		        		return html;
		        	}
		        },
		        {
					field: 'isEdit',
					title: '编辑',
					width: "32",
					formatter: function (value, row, index) {
						var isCheck = value == 1 ? 'checked' : '';
						var html = opt.common.sprintf("<label class='check-box'><input type='checkbox' name='columns[%s].isEdit' value='1' %s></label>", index, isCheck);
						return html;
					}
				},
		        {
		            field: 'isList',
		            title: '列表',
					titleTooltip:'数据展示页面表格列表',
					width: "32",
					hbgr:'#eaedf1',
		            formatter: function (value, row, index) {
		            	var isCheck = value == 1 ? 'checked' : '';
		            	var html = opt.common.sprintf("<label class='check-box'><input type='checkbox' name='columns[%s].isList' value='1' %s></label>", index, isCheck);
		        		return html;
		        	}
		        	// ,
					// cellStyle: function(value, row, index) {
					//     return { css: { "background-color": "red" } };
					// }
		        },
		        /*{
		            field: 'listOrder',
		            title: '列表序号',
		            width: "10%",
		            formatter: function (value, row, index) {
		            	var v = value == 0 ? "" : value;
		            	var html = opt.common.sprintf("<input class='form-control' type='text' name='columns[%s].listOrder' value='%s'>", index, v);
		        		return html;
		        	}
		        },*/
		        {
		            field: 'isQuery',
		            title: '查询',
					hbgr:'#eaedf1',
					width: "32",
		            formatter: function (value, row, index) {
		            	var isCheck = value == 1 ? 'checked' : '';
		            	var html = opt.common.sprintf("<label class='check-box'><input type='checkbox' name='columns[%s].isQuery' value='1' %s></label>", index, isCheck);
		        		return html;
		        	}
		        },
		        {
		            field: 'queryType',
		            title: "查询方式"+ "<a tabindex='0' role='button' data-toggle='popover' data-trigger='focus' " +
							"data-placement='top' data-html='true' data-content='<span style=\"color:red\">展示页面列表需要检索字段的查询方式!<span>'><i class='fa fa-question-circle-o' style='color: orange'></i></a>",
					hbgr:'#eaedf1',
		            width: "8%",
		            formatter: function (value, row, index) {
		            	var data = { "index": index, "queryType": value };
		                // return $("#queryTypeTpl").tmpl(data).html();
						return opt.template('queryTypeTpl',data);
		        	}
		        },
				{
					field: 'isTableSort',
					title: "排序",
					titleTooltip:'表格按照此字段排序展示!',
					hbgr:'#eaedf1',
					width: "32",
					formatter: function (value, row, index) {
						var isCheck = value == 1 ? 'checked' : '';
						var html = opt.common.sprintf("<label class='check-box'><input type='checkbox' name='columns[%s].isTableSort' value='1' %s></label>", index, isCheck);
						return html;
					}
				},
		        {
		            field: 'isRequired',
		            title: '必填',
					width: "32",
		            formatter: function (value, row, index) {
		            	var isCheck = value == 1 ? 'checked' : '';
		            	var html = opt.common.sprintf("<label class='check-box'><input type='checkbox' name='columns[%s].isRequired' value='1' %s></label>", index, isCheck);
		        		return html;
		        	}
		        },

		        {
		            field: 'htmlType',
		            title: '显示类型',
		            width: "10%",
		            formatter: function (value, row, index) {
		            	var data = { "index": index, "htmlType": value };
		                // return $("#htmlTypeTpl").tmpl(data).html();
						return opt.template('htmlTypeTpl',data);
		        	}
		        },
				{
					field: 'circleType',
					title: '字段说明样式',
					titleTooltip:'字段说明样式',
					width: "8%",
					formatter: function (value, row, index) {
						var data = { "index": index, "circleType": value };
						// return $("#circleTypeTpl").tmpl(data).html();
						return opt.template('circleTypeTpl',data);
					}
				},
				{
					field: 'editInfo',
					title: '字段说明',
					width: "10%",
					formatter: function (value, row, index) {
						var html = opt.common.sprintf("<input class='form-control' type='text' name='columns[%s].editInfo' value='%s' id='columns_edit_info_%s'>", index, value, row.id);
						return "<div class='input-group'>" + html + "<span class='input-group-btn'><a  href='javascript:;' onclick='selectinputEdit(\"" + row.id +"\", this)'><i class='fa fa-fw fa-edit'></i></a></span>";
					}
				},
		        {
		            field: 'dictType',
		            title: '字典类型',
		            width: "15%",
		            formatter: function (value, row, index) {
		        		var html = opt.common.sprintf("<input class='form-control' type='text' name='columns[%s].dictType' value='%s' id='columns_dict_%s'>", index, value, row.id);
						return "<div class='input-group'>" + html + "<span class='input-group-btn'><a  href='javascript:;' onclick='selectDictTree(\""+ row.id+"\", this)'><i class='fa fa-fw fa-search'></i></a></span>";
		        	}
		        }]
				// ]
		    };
		    $.table.init(options);

		});
		
		/*当拖拽结束后处理函数*/
		function onReorderRow(data) {
	        for (var i = 0; i < data.length; i++) {
			    $("#columns_sort_" + data[i].id).val(i+1);
			}
       };
		
		$(function() {
            var tplCategory = $("#tplCategory option:selected").val();
            tplCategoryVisible(tplCategory);
        });
		
		$('#tplCategory').on('select2:select', function (event) {
			var tplCategory = $(event.target).val();
			tplCategoryVisible(tplCategory);
		});
		
		function tplCategoryVisible(tplCategory) {
			if("crud" == tplCategory){
				$("#treeCode").select2("val", [""]);
				$("#treeParentCode").select2("val", [""]);
				$("#treeName").select2("val", [""]);
				$("#otherInfo").addClass("hidden");
				$("#isTabOpen").removeClass("hide");
				$("#isTableDel").addClass("hide");
				$("#isTabOpen").removeClass("hide");
				$("#isTableBut").removeClass("hide");
				$("#isTableFile").removeClass("hide");
				$("#setTable").removeClass("hide");
			} else if("tree" == tplCategory){
				$("#isTableDel").addClass("hide");
				$("#otherInfo").removeClass("hidden");
				$("#treeCode").attr("required", "true");
				$("#treeParentCode").attr("required", "true");
				$("#treeName").attr("required", "true");
				$("#isTabOpen").addClass("hide");
			} else if("r" == tplCategory){
				$("#isTabOpen").addClass("hide");
				$("#treeCode").select2("val", [""]);
				$("#treeParentCode").select2("val", [""]);
				$("#treeName").select2("val", [""]);
				$("#otherInfo").addClass("hidden");
				$("#isTableDel").removeClass("hide");
				$("#isTabOpen").addClass("hide");
				$("#isTableBut").addClass("hide");
				$("#isTableFile").addClass("hide");
				$("#setTable").removeClass("hide");
			} else if("service" == tplCategory || "entity" == tplCategory){
				$("#isTabOpen").addClass("hide");
				$("#treeCode").select2("val", [""]);
				$("#treeParentCode").select2("val", [""]);
				$("#treeName").select2("val", [""]);
				$("#otherInfo").addClass("hidden");
				$("#isTableDel").addClass("hide");
				$("#isTabOpen").addClass("hide");
				$("#isTableBut").addClass("hide");
				$("#isTableFile").addClass("hide");
				$("#setTable").addClass("hide");
			}
        };

		/*选择字典处理函数*/
		function selectDictTree(id, obj) {
			console.log("" + id);
			var dictType = opt.common.nullToStr($("#columns_dict_"+id).val(),"-");
        	var url = baseURL + "sys/dict/getDictTree/" + id + "/" + dictType;
			var options = {
				title: '选择字典类型',
				width: "380",
				url: url,
				callBack: doSubmit
			};
			opt.modal.openOptions(options);
		};
		function doSubmit(index, layero){
			var body = layer.getChildFrame('body', index);
   			var id = body.find('#columnId').val();
   			var dictType = body.find('#dictType').val();
   			console.log("--->>:" +"#columns_dict_" + id);
   			$("#columns_dict_" + id).val(dictType);
			layer.close(index);
		};

		/*选择字典处理函数*/
		function selectinputEdit(id, obj) {
			var text = opt.common.nullToStr($("#columns_edit_info_"+id).val(),"-");
			var url = prefix + "/inputEdit/" + id + "/" + text;
			var options = {
				title: '填写说明',
				width: "500",
				height: "350",
				url: url,
				callBack: inputDoSubmit
			};
			opt.modal.openOptions(options);
		};
		function inputDoSubmit(index, layero){
			var body = layer.getChildFrame('body', index);
			var id = body.find('#columnId').val();
			var text = body.find('#inputEdit').val();
			$("#columns_edit_info_" + id).val(text);
			layer.close(index);
		};


		/*选择路径函数*/
		function selectDirTree() {
			var url =  prefix + "/getDirTree";
			var options = {
				title: '选择本机路径',
				width: "480",
				url: url,
				callBack: doDirSubmit
			};
			opt.modal.openOptions(options);
		};

		function doDirSubmit(index, layero){
			var body = layer.getChildFrame('body', index);
			var path = body.find('#path').val();
			$("#runPath").val(path+"\\");
			layer.close(index);
		};
    </script>
</@footer>
</@pageTheme>
<#noparse>
<!-- java类型 -->
<script id="javaTypeTpl" type="text/template">//<!--
<div>
<select class="form-control" name="columns[{{d.index}}].javaType">
    <option value="Long" {{# if (d.javaType ==="Long"){ }}selected{{# } }}>Long</option>
    <option value="String" {{# if (d.javaType ==="String"){ }}selected{{# } }}>String</option>
    <option value="Integer" {{# if (d.javaType ==="Integer"){ }}selected{{# } }}>Integer</option>
    <option value="Double" {{# if (d.javaType ==="Double"){ }}selected{{# } }}>Double</option>
    <option value="BigDecimal" {{# if (d.javaType ==="BigDecimal"){ }}selected{{# } }}>BigDecimal</option>
    <option value="Date" {{# if (d.javaType ==="Date"){ }}selected{{# } }}>Date</option>
</select>
</div>
//-->
</script>

<!-- 查询方式 -->
<script id="queryTypeTpl" type="text/template">//<!--
<div>
<select class="form-control" name="columns[{{d.index}}].queryType">
    <option value="EQ" {{# if (d.queryType ==="EQ"){ }}selected{{# } }}>=</option>
    <option value="NE" {{# if (d.queryType ==="NE"){ }}selected{{# } }}>!=</option>
    <option value="GT" {{# if (d.queryType ==="GT"){ }}selected{{# } }}>></option>
    <option value="GTE" {{# if (d.queryType ==="GTE"){ }}selected{{# } }}>>=</option>
    <option value="LT" {{# if (d.queryType ==="LT"){ }}selected{{# } }}><</option>
    <option value="LTE" {{# if (d.queryType ==="LTE"){ }}selected{{# } }}><=</option>
    <option value="LIKE" {{# if (d.queryType ==="LIKE"){ }}selected{{# } }}>Like</option>
    <option value="BETWEEN" {{# if (d.queryType ==="BETWEEN"){ }}selected{{# } }}>Between</option>
</select>
</div>
//-->
</script>

<!-- 显示类型 -->
<script id="htmlTypeTpl" type="text/template">//<!--
<div>
<select class="form-control" name="columns[{{d.index}}].htmlType">
    <option value="input" {{# if (d.htmlType ==="input"){ }}selected{{# } }}>文本框</option>
    <option value="textarea" {{# if (d.htmlType ==="textarea"){ }}selected{{# } }}>文本域</option>
    <option value="select" {{# if (d.htmlType ==="select"){ }}selected{{# } }}>多选下拉框</option>
    <option value="dselect" {{# if (d.htmlType ==="dselect"){ }}selected{{# } }}>单选下拉框</option>
    <option value="radio" {{# if (d.htmlType ==="radio"){ }}selected{{# } }}>单选框</option>
    <option value="checkbox" {{# if (d.htmlType ==="checkbox"){ }}selected{{# } }}>复选框</option>
    <option value="datetime" {{# if (d.htmlType ==="datetime"){ }}selected{{# } }}>日期控件</option>
    <option value="icon" {{# if (d.htmlType ==="icon"){ }}selected{{# } }}>选择图标</option>
    <option value="user" {{# if (d.htmlType ==="user"){ }}selected{{# } }}>选择用户</option>
    <option value="dept" {{# if (d.htmlType ==="dept"){ }}selected{{# } }}>选择部门</option>
    <option value="comp" {{# if (d.htmlType ==="comp"){ }}selected{{# } }}>选择公司</option>
    <option value="imgcup" {{# if (d.htmlType ==="imgcup"){ }}selected{{# } }}>图片剪辑</option>
    <option value="addr" {{# if (d.htmlType ==="addr"){ }}selected{{# } }}>多级地址</option>
</select>
</div>
//-->
</script>

<!-- 说明样式 -->
<script id="circleTypeTpl" type="text/template">//<!--
<div>
<select class="form-control" name="columns[{{d.index}}].circleType">
    <option value="T" {{# if (d.circleType ==="T"){ }}selected{{# } }}>普通样式</option>
    <option value="Q" {{# if (d.circleType ==="Q"){ }}selected{{# } }}>黄色问号</option>
    <option value="R" {{# if (d.circleType ==="R"){ }}selected{{# } }}>红色明显</option>
</select>
</div>
//-->
</script>
</#noparse>


